<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste da API de Usuários</title>
</head>
<body>
    <h1>Gerenciador de Usuários</h1>

    <h2>Criar Novo Usuário</h2>
    <form id="user-form">
        <input type="text" id="name" placeholder="Nome" required />
        <input type="email" id="email" placeholder="Email" required />
        <button type="submit">Criar</button>
    </form>

    <h2>Lista de Usuários</h2>
    <ul id="user-list">
        <li>Carregando...</li>
    </ul>

    <script>
        const API_URL = 'http://localhost:3000/v1/users';
        const userForm = document.getElementById('user-form');
        const userList = document.getElementById('user-list');

        // Função para renderizar a lista de usuários na tela
        function renderUsers(users) {
            userList.innerHTML = ''; // Limpa a lista
            users.forEach(user => {
                const li = document.createElement('li');
                li.textContent = `ID: ${user._id} - Nome: ${user.name} - Email: ${user.email}`;
                userList.appendChild(li);
            });
        }

        // Função para buscar e exibir os usuários
        async function fetchAndRenderUsers() {
            try {
                const response = await fetch(API_URL);
                const users = await response.json();
                renderUsers(users);
            } catch (error) {
                console.error('Erro ao buscar usuários:', error);
                userList.innerHTML = '<li>Falha ao carregar usuários.</li>';
            }
        }

        // Evento de envio do formulário
        userForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Impede o recarregamento da página

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;

            const userData = { name, email };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData),
                });

                if (response.ok) {
                    alert('Usuário criado com sucesso!');
                    userForm.reset(); // Limpa o formulário
                    fetchAndRenderUsers(); // Atualiza a lista de usuários
                } else {
                    alert('Erro ao criar usuário.');
                }
            } catch (error) {
                console.error('Erro na requisição POST:', error);
                alert('Falha na comunicação com a API.');
            }
        });

        // Carrega os usuários assim que a página é aberta
        fetchAndRenderUsers();
    </script>
</body>
</html>